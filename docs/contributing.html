---

title: How to contribute


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/contributing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/contributing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Report-Bugs">Report Bugs<a class="anchor-link" href="#Report-Bugs"> </a></h2><p>Report bugs at <a href="https://github.com/MannLabs/alphapept/issues">https://github.com/MannLabs/alphapept/issues</a>.</p>
<p>If you are reporting a bug, please include:</p>
<ul>
<li>Your operating system name and version.</li>
<li>Any details about your local setup that might be helpful in troubleshooting.</li>
<li>Detailed steps to reproduce the bug.</li>
</ul>
<h2 id="Fix-Bugs">Fix Bugs<a class="anchor-link" href="#Fix-Bugs"> </a></h2><p>Look through the GitHub issues for bugs. Anything tagged with "bug"
and "help wanted" is open to whoever wants to implement it.</p>
<h2 id="Implement-Features">Implement Features<a class="anchor-link" href="#Implement-Features"> </a></h2><p>Look through the GitHub issues for features. Anything tagged with "enhancement"
and "help wanted" is open to whoever wants to implement it.</p>
<h2 id="Write-Documentation">Write Documentation<a class="anchor-link" href="#Write-Documentation"> </a></h2><p>AlphaPept could always use more documentation, whether as part of the
official AlphaPept documentation, in docstrings, or even on the web in blog posts,
articles, and such. See below for our docstring convention.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Submit-Feedback">Submit Feedback<a class="anchor-link" href="#Submit-Feedback"> </a></h2><p>The best way to send feedback is to file an issue at <a href="https://github.com/MannLabs/alphapept/issues">https://github.com/MannLabs/alphapept/issues</a>.</p>
<p>If you are proposing a feature:</p>
<ul>
<li>Explain in detail how it would work.</li>
<li>Keep the scope as narrow as possible, to make it easier to implement.</li>
<li>Remember that this is a volunteer-driven project, and that contributions
are welcome :)</li>
</ul>
<h2 id="Get-Started!">Get Started!<a class="anchor-link" href="#Get-Started!"> </a></h2><p>Ready to contribute? Here's how to set up <code>alphapept</code> for local development.</p>
<ol>
<li>Fork the <code>alphapept</code> repo on GitHub.</li>
<li><p>Clone your fork locally:</p>

<pre><code> git clone git@github.com:your_name_here/alphapept.git</code></pre>
</li>
<li><p>Follow the installation instructions in the readme to install a alphapept environment.</p>
</li>
<li><p>Create a branch for local development::</p>

<pre><code> git checkout -b name-of-your-bugfix-or-feature</code></pre>
<p>Now you can make your changes locally.</p>
</li>
<li><p>See below in the Notes for Programmers about how to use the nbdev environment.</p>
</li>
<li><p>Commit your changes and push your branch to GitHub::</p>

<pre><code> git add .
 git commit -m "Your detailed description of your changes."
 git push origin name-of-your-bugfix-or-feature</code></pre>
</li>
<li><p>Submit a pull request through the GitHub website.</p>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PR-submission-guidelines">PR submission guidelines<a class="anchor-link" href="#PR-submission-guidelines"> </a></h2><ul>
<li>Keep each PR focused. While it's more convenient, do not combine several unrelated fixes together. Create as many branches as needed to keep each PR focused.</li>
<li>Do not mix style changes/fixes with "functional" changes. It's very difficult to review such PRs, and it most likely gets rejected.</li>
<li>Do not turn an already submitted PR into your development playground. If after you submitted PR, you discovered that more work is needed - close the PR, do the required work and then submit a new PR. Otherwise, each of your commits requires attention from maintainers of the project.</li>
<li>If, however, you submitted a PR and received a request for changes, you should proceed with commits inside that PR, so that the maintainer can see the incremental fixes and won't need to review the whole PR again. In the exceptional case where you realize it'll take many many commits to complete the requests, then it's probably best to close the PR, do the work and then submit it again. Again, use common sense where you'd choose one way over another.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notes-for-Programmers">Notes for Programmers<a class="anchor-link" href="#Notes-for-Programmers"> </a></h2><h3 id="Literal-Programming">Literal Programming<a class="anchor-link" href="#Literal-Programming"> </a></h3><p>A key feature is the use of <a href="https://github.com/fastai/nbdev">nbdev</a>. We like to keep the entrance barrier low to attract new coders to contribute to the AlphaPept package. For this, we see nbedv as an ideal tool to document and modify code. To install nbdev use <code>pip install nbdev</code> and then install the git hooks in the folder where your GitHub repository is cloned (<code>nbdev_install_git_hooks</code>). The key commands for nbdev are:</p>
<ul>
<li><code>nbdev_build_lib</code>: build the library from the notebooks</li>
<li><code>nbdev_test_nbs</code>: test all notebooks</li>
<li><code>nbdev_clean_nbs</code>: clean the notebooks (strip from unnecessary metadata)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Docstring-convention">Docstring convention<a class="anchor-link" href="#Docstring-convention"> </a></h3><p>The docstring convention we adhere to is from the <a href="https://google.github.io/styleguide/pyguide.html">Google stylegyuide</a>.</p>
<p>Below a sample docstring (Note the empty space after Args/Returns/Raises):</p>

<pre><code>def sample_function(a_string: str, a_int: int, a_flag: bool) -&gt; str:
    """
    Sample function that performs a sample calculation.

    Args:
        a_string: A string.
        a_int: An integer.
        a_flag: A flag.

    Returns:
        A string based on the input.  

    Raises:
        ValueError: An error occured when the integer is negative.

    """</code></pre>
<blockquote><p>Note that type hints are highly recommended but not mandatory (see also <a href="https://www.python.org/dev/peps/pep-0484/">PEP484</a>). As the Legacy codebase had no type hints we are slowly moving towards more type hinting coverage.
Note that adding additional elements to the docstring could break how the documentation is displayed. Below is the function from above but exported to show how it would appear in the documentation.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sample_function" class="doc_header"><code>sample_function</code><a href="https://github.com/mannlabs/alphapept/tree/master/alphapept/contributing.py#L6" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sample_function</code>(<strong><code>a_string</code></strong>:<code>str</code>, <strong><code>a_int</code></strong>:<code>int</code>, <strong><code>a_flag</code></strong>:<code>bool</code>)</p>
</blockquote>
<p>Sample function that performs a sample calculation.</p>
<p>Args:
    a_string: A string.
    a_int: An integer.
    a_flag: A flag.</p>
<p>Returns:
    A string based on the input.</p>
<p>Raises:
    ValueError: An error occured when the integer is negative.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h2><p>In order to make AlphaPept a sustainable package, it is imperative that all functions have tests. This is not only to ensure the proper execution of the function but also for the long run when wanting to keep up-to-date with package updates. For tracking package updates, we rely on <a href="https://dependabot.com">dependabot</a>. For continuous integration, we use GitHub Actions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Unit-Tests">Unit Tests<a class="anchor-link" href="#Unit-Tests"> </a></h3><p>Within the nbdev notebooks, we try to write small tests for each function. They should be lightweight so that running (and hence testing) the notebooks should not take too long. You define your code in a cell with the <code>#export</code>-flag and you can write a text in the following cell. To prevent the cell from showing up in the documentation, you can add a <code>#hide</code>-flag. To be flexible and maybe migrate from the notebook tests to <code>pytest</code> we write the tests with leading <code>test_</code> and the function name and execute it in the cell.</p>
<h4 id="Example">Example<a class="anchor-link" href="#Example"> </a></h4><p>Cell that defines the code:</p>

<pre><code>#export

def function_a():
    return 5</code></pre>
<p>Next cell with the test function and calling the test.</p>

<pre><code>def test_function_a():
    assert function_a() == 5

test_function_a()</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="GitHub-Actions">GitHub Actions<a class="anchor-link" href="#GitHub-Actions"> </a></h3><p>We use GitHub Actions as part of the continuous integration framework.</p>
<p>Within the repository, the actions are defined as yml files in <code>./.github/workflows/</code>.</p>
<p>Currently, the following actions are present:</p>
<ul>
<li>cla_assistant: Action that runs a check if a contributor has signed the CLA</li>
<li>gpu_test: Helper to run GPU tests. This is not part of the automated pipeline</li>
<li>main: Main CI/CD from nbdev. This installs the library and runs all notebooks</li>
<li>performance_test: This action freezes the environment and runs multiple test cases specified in <code>test_ci.py</code>. Used to benchmark new versions.</li>
<li>quick_test: This action runs the whole AlphaPept pipeline on small test files</li>
<li>release: This action triggers the installer compilation and creates a release draft</li>
</ul>
<p>The <code>quick_test</code> and <code>performance_test</code> are hooked to the MongoDB, so results are reported here.</p>
<p>Some actions are executed on each push (e.g. <code>quick_test</code>, others need to be triggered manually (e.g. <code>release</code>).</p>
<h3 id="Adding-an-integration-test">Adding an integration test<a class="anchor-link" href="#Adding-an-integration-test"> </a></h3><p>The best way to add an integration test is by specifying a new test in <code>test_ci.py</code> and then adding a job to the <code>performance_test</code> action. <code>test_ci.py</code> contains a file dictionary with links to files. The idea here is as follows: On the local machine, there should be a <code>BASE_DIR</code> that contains all files used for running the test cases. If the files are not present, the script will download them with the URL from the file dictionary. To define a test case, one needs to initiate a <code>TestRun</code>-class and provide the files to be used. Running a test will always take the current <code>default_settings.yaml</code> and modifying the respective files. You can add subsequent analysis (e.g., such as calculating the false discovery FDR for a mixed species experiment by adding a function to the test class.</p>
<p>To test an integration test locally, simply call the <code>test_ci.py</code> with the respective test (e.g. thermo_irt) like so: <code>python test_ci.py thermo_irt</code>.</p>
<h3 id="Integrating-Actions">Integrating Actions<a class="anchor-link" href="#Integrating-Actions"> </a></h3><p>{% include note.html content='Unless you are a core developer, there should not be the need to add actions.' %}
New actions can be added by creating a <code>.yml</code> file and placing it in the workflows folder.
We can distinguish local actions, which run on our self-hosted <a href="https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners">runners</a>  and cloud actions that run on GitHub servers.</p>
<p>The local runners are meant to run computationally intensive tasks such as the <code>performance_test</code> and the <code>quick_test</code>, whereas the cloud actions are meant for unit tests.
{% include note.html content='If you fork the repository, you will not be able to execute tests on the local runners. They are restricted to the <code>MannLabs</code> repository. ' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-Coverage">Test Coverage<a class="anchor-link" href="#Test-Coverage"> </a></h2><p>Ideally, we would like to track test coverage. However, this isn't easy when having numba-compiled functions. Any solutions to this are greatly appreciated.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linting">Linting<a class="anchor-link" href="#Linting"> </a></h2><p>It is planned to include a GitHub action that automatically runs a linter on the code.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Callbacks">Callbacks<a class="anchor-link" href="#Callbacks"> </a></h3><p>As AlphaPept is intended to be the backend of a tool with GUI, we ideally want to be able to get a progress bar out of the major functions. For this, we can pass a <code>callback</code>-argument to the major functions. If the argument is passed, it will return the current progress in the range from 0 to 1.</p>
<h3 id="Version-bumping">Version bumping<a class="anchor-link" href="#Version-bumping"> </a></h3><p>We are using the python package <code>bump2version</code>. You can use this to bump the version number (install via <code>pip install bump2version</code>). Currently specified is: <code>bump2version</code>: (<code>major</code>, <code>minor</code>, <code>patch</code>):</p>
<ul>
<li>e.g.: <code>bump2version patch</code> for a patch</li>
</ul>

</div>
</div>
</div>
</div>
 

